<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>佑佑的数学作业</title>

    <!-- Bootstrap -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="js/jquery-1.8.0.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>
    .a4-endwise {
        width: 1075px;
        height: 1567px;
        /*border: 1px #000 solid;*/
        overflow: hidden;
        padding: 0;
        word-break: break-all;
    }

    .a4-broadwise {
        width: 1569px;
        height: 1073px;
        /*border: 1px #000 solid;*/
        overflow: hidden;
        padding: 0;
        word-break: break-all;
    }

    .print {
        position: fixed;
        right: 5%;
    }

    .beforeHeader,
    .afterFooter {
        display: none;
    }

    table {
        width: 100%;
    }

    tr {
        width: 100%;
        font-size: 5.9mm;


    }

    .tdq {
        width: 45%;
        padding-left: 1em;
    }

    .tdn {
        width: 5%;
        text-align: right;
    }

    @media print {
        /* 打印时显示 */
        .beforeHeader,
        .afterFooter {
            display: block;
        }
    }

    .inputdiv {
        width: 1075px;
        height: 6em;
        border: 1px #000 solid;
        overflow: hidden;
        padding: 0;
        word-break: break-all;
    }

</style>
<body>
<a class="print" href="javascript:;" onclick="preview();">打印</a><br/>
<a class="print" href="javascript:;" onclick="redoexam('hi world');">重新出题</a>
<div class="container inputdiv">
    <table>
        <tr>
            <th>出题范围</th>
            <th>参数最大值</th>
            <th>结果最大值</th>
        </tr>
        <tr>
            <td><select id="range">
                <option value="jiafa">加法</option>
                <option value="jianfa">减法</option>
                <option value="chengfa">乘法</option>
                <option value="chufa">除法</option>
                <option value="jiajian">加减法</option>
                <option value="chengchu">乘除法</option>
                <option value="sizehunhe">四则混合计算</option>
            </select></td>
            <td><input id="maxnum" value="12" /></td>
            <td><input id="maxresult" value="100"/></td>
        </tr>

    </table>
</div>
<br/>


<!--startprint-->
<div class="container a4-endwise" id="test">
    <table id="examOne" >

        <script>
            var text = "";
            var q1 = "1 &#215; 2=";
            var q2 = "3 &#215; 2=";
            for (i = 0; i < 50; i++) {
                var j, k = 0;
                j = i + 1;
                k = i + 50 + 1;
                text += "<tr>" + "<td class='tdn'>" + j + "</td>"
                    + "<td class='tdq'>" + q1 + "</td>"
                    + "<td class='tdn'>" + k + "</td>"
                    + "<td class='tdq'>" + q2 + "</td>" + "</tr>";
            }
            document.getElementById("examOne").innerHTML = text;
        </script>

    </table>

</div>
<div class="container a4-endwise">
    <table id="examTwo">

        <script>
            var text = "";
            var q1 = "1 &#215; 2=";

            var q2 = "3 &#215; 2=";
            for (i = 0; i < 50; i++) {
                var j, k = 0;
                j = i + 1;
                k = i + 50 + 1;
                text += "<tr>" + "<td class='tdn'>" + j + "</td>"
                    + "<td class='tdq'>" + q1 + "</td>"
                    + "<td class='tdn'>" + k + "</td>"
                    + "<td class='tdq'>" + q2 + "</td>" + "</tr>";
            }
            document.getElementById("examTwo").innerHTML = text;
        </script>
    </table>
</div>

<!--endprint-->

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-1.8.0.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>

    function redoexam(tablename) {

        $(".tdq").each(function (i, e) {
            $(this).context.innerText = getOneQst();
        });
    }

    function getOneQst() { //出一道数学题
        var range = document.getElementById("range");
        var index = range.selectedIndex;
        var rangeselect = range.options[index].value;
        var maxnum = $("#maxnum").val();
        var maxresult = $("#maxresult").val();

        if (maxnum < 10 || maxresult < 0) {
            alert("参数大于10，结果大于0");
            return;
        }

        //四则混合计算-------------------
        //生成运算符
        //生成运算符个数1-4
        var nofo=0;
        var ofo = []; //1- add; 2- sub;3-multi;4-div
        var numbers = []; //操作数比运算符多一个
        var checkresult = -1;
        do {
            ofo=[];
            numbers=[];
            nofo = randomNum(1, 4);

            for (i = 0; i < nofo; i++) {
                ofo[i] = randomNum(1, 4);
            }

            for (i = 0; i < nofo + 1; i++) {
                numbers[i] = 0;
            }


            //生成除法
            for (i = 0; i < nofo; i++) {
                //从左到右遍历操作符，如果是除法，先生成除数（保证不为0，且能整除），再生成被除数
                if (ofo[i] == 4) {
                    if (numbers[i] == 0) {
                        numbers[i + 1] = randomNum(1, maxnum);
                        numbers[i] = randomNum(0, maxnum) * numbers[i + 1];
                    } else //连续的除号，被除数已经有了
                    {
                        var divideSet = [];
                        var k = 0;
                        for (j = 1; j < numbers[i] + 1; j++) {
                            if (numbers[i] % j == 0) {
                                divideSet[k] = j;
                                k++;
                            }
                        }
                        if (k > 1) {
                            numbers[i + 1] = divideSet[randomNum(0, k - 1)];
                        } else {
                            numbers[i + 1] = 1;
                        }

                    }
                }
            }
            //生成其他算法
            for (i = 0; i < nofo; i++) {
                if (ofo[i] != 4) { //不是除法，对计算符两边没有要求，随机生成两边数字
                    if (numbers[i] == 0) {
                        numbers[i] = randomNum(0, maxnum);
                    }
                    if (numbers[i + 1] == 0) {
                        numbers[i + 1] = randomNum(0, maxnum);
                    }
                }
            }

            //验证计算结果
            var ofo1=ofo.slice(0);
            var numbers1=numbers.slice(0);
            //先乘除，再加减

            for (i = 0; i < nofo; i++ ) {
                if (ofo1[i] > 2) {
                    if (ofo1[i] == 3) {
                        //multi
                        numbers1[i + 1] = numbers1[i] * numbers1[i + 1];
                        numbers1[i] = 0;
                        ofo[i] = 1;
                    } else {
                        //div
                        numbers1[i + 1] = numbers1[i] / numbers1[i + 1];
                        numbers1[i] = 0;
                        ofo1[i] = 1;
                    }
                }
            }

            for (i = 0; i < nofo; i++) {

                if (ofo1[i] == 1) {
                    //add
                    numbers1[i + 1] = numbers1[i] + numbers1[i + 1];
                    numbers1[i] = 0;
                } else {
                    //sub
                    numbers1[i + 1] = numbers1[i] - numbers1[i + 1];
                    numbers1[i] = 0;
                }
            }
            checkresult = numbers1[nofo + 1];


        }while (checkresult>=0);

        //拼出算式 +-×÷
        var chen = " × ";
        var chu = " ÷ ";

        resultfactor = numbers[0];
        for (i = 0; i < nofo; i++) {
            switch (ofo[i]) {
                case 1:
                    resultfactor = resultfactor + " + " + numbers[i + 1];
                    break;
                case 2:
                    resultfactor = resultfactor + " - " + numbers[i + 1];
                    break;
                case 3:
                    resultfactor = resultfactor + chen + numbers[i + 1];
                    break;
                case 4:
                    resultfactor = resultfactor + chu + numbers[i + 1];
                    break;
                default:
                    resultfactor = resultfactor + "error";

            }
        }
        resultfactor = resultfactor + " = "+checkresult;
       // alert(resultfactor);
        return resultfactor;


    }

    //生成从minNum到maxNum的随机数
    function randomNum(minNum, maxNum) {
        switch (arguments.length) {
            case 1:
                return parseInt(Math.random() * minNum + 1, 10);
                break;
            case 2:
                return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                break;
            default:
                return 0;
                break;
        }
    }

    function preview() { //打印
        bdhtml = window.document.body.innerHTML;//获取当前页的html代码
        sprnstr = "<!--startprint-->";//设置打印开始区域
        eprnstr = "<!--endprint-->";//设置打印结束区域
        prnhtml = bdhtml.substring(bdhtml.indexOf(sprnstr) + 18); //从开始代码向后取html
        prnhtml = prnhtml.substring(0, prnhtml.indexOf(eprnstr));//从结束代码向前取html
        window.document.body.innerHTML = prnhtml;

        //打印之前设置IE打印时不打印页眉 、页脚，其他浏览器不起作用
        if (!!window.ActiveXObject || "ActiveXObject" in window) {
            remove_ie_header_and_footer();
        }


        window.print();
        window.document.body.innerHTML = bdhtml;
    }

    //打印之前设置IE打印时不打印页眉 、页脚，其他浏览器不起作用
    function remove_ie_header_and_footer() {
        alert("hi");
        var hkey_root, hkey_path, hkey_key;
        hkey_root = "HKEY_CURRENT_USER";
        hkey_path = "\\Software\\Microsoft\\Internet Explorer\\PageSetup\\";
        try {
            var RegWsh = new ActiveXObject("WScript.Shell");
            hkey_key = "header";
            RegWsh.RegWrite(hkey_root + hkey_path + hkey_key, "");
            hkey_key = "footer";
            RegWsh.RegWrite(hkey_root + hkey_path + hkey_key, "");
        } catch (e) {
        }
    }


</script>

</body>
</html>